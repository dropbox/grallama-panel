{"version":3,"sources":["../src/grallama_ctrl.js"],"names":["MetricsPanelCtrl","_","kbn","TimeSeries","rendering","GraLLAMACtrl","$scope","$injector","$rootScope","panelDefaults","legend","show","values","links","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","legendType","aliasColors","format","valueName","valueNameOptions","text","value","strokeWidth","fontSize","combine","threshold","label","tooltipHover","colorBackground","colorValue","colors","thresholds","xAxisLabel","yAxisLabel","separator","healthCheckThreshold","healthCheckOperator","healthCheckOperatorOptions","defaults","panel","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","addEditorTab","unitFormats","getUnitFormats","subItem","render","series","color","alias","data","parseSeries","matrix","parseMatrix","dataValue","op","that","style","numUnhealthy","yCats","Set","xCats","split","map","strVale","Number","trim","numUnhealthyCells","angular","forEach","datapoint","agg","stats","datavalue","toFixed","performHealthCheck","yCat","xCat","add","Array","from","sort","rowNum","colNum","push","toString","cell","limit","i","cells","serie","dataList","seriesHandler","seriesData","datapoints","target","flotpairs","getFlotPairs","scope","elem","attrs","ctrl","options","background","reverse","panelColorIndex","templateUrl"],"mappings":"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","file":"grallama_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport TimeSeries from 'app/core/time_series';\nimport rendering from './rendering';\n\nexport class GraLLAMACtrl extends MetricsPanelCtrl {\n\n  constructor($scope, $injector, $rootScope) {\n    super($scope, $injector);\n    this.$rootScope = $rootScope;\n\n    var panelDefaults = {\n      legend: {\n        show: true, // disable/enable legend\n        values: true\n      },\n      links: [],\n      datasource: null,\n      maxDataPoints: 3,\n      interval: null,\n      targets: [{}],\n      cacheTimeout: null,\n      nullPointMode: 'connected',\n      legendType: 'Under graph',\n      aliasColors: {},\n      format: 'short',\n      valueName: 'avg',\n      valueNameOptions: [\n        { text: \"Min\", value: \"min\" },\n        { text: \"Max\", value: \"max\" },\n        { text: \"Average\", value: \"avg\" },\n        { text: \"Current\", value: \"current\" },\n        { text: \"Total\", value: \"total\" }\n      ],\n      strokeWidth: 1,\n      fontSize: '60%',\n      combine: {\n        threshold: 0.0,\n        label: 'Others'\n      },\n      tooltipHover: false, // Should there be a tooltip for cells\n      colorBackground: true, // Should the cell background be colored\n      colorValue: false, // Should the cell value be colored\n      colors: ['#6ea009', \"#D38E02\", \"#C86501\", \"#BD3D01\", \"#AD0000\"],\n      thresholds: '0,0.2,1,5,99',\n      xAxisLabel: 'X-Axis',\n      yAxisLabel: 'Y-Axis',\n      separator: '-',\n      healthCheckThreshold: '0.2',\n      healthCheckOperator: '<',\n      healthCheckOperatorOptions: [{ text: \"<\", value: \"<\" }, { text: \">=\", value: \">=\" }, { text: \"=\", value: \"=\" } ]\n    };\n\n    _.defaults(this.panel, panelDefaults);\n    _.defaults(this.panel.legend, panelDefaults.legend);\n\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Axes', 'public/plugins/dropbox-grallama-panel/axes_editor.html', 2);\n    this.addEditorTab('Options', 'public/plugins/dropbox-grallama-panel/options_editor.html', 3);\n    this.unitFormats = kbn.getUnitFormats();\n  }\n\n  setUnitFormat(subItem) {\n    this.panel.format = subItem.value;\n    this.render();\n  }\n\n  onDataError() {\n    this.series = [];\n    this.render();\n  }\n\n  changeSeriesColor(series, color) {\n    series.color = color;\n    this.panel.aliasColors[series.alias] = series.color;\n    this.render();\n  }\n\n  onRender() {\n    this.data = this.parseSeries(this.series);\n    this.matrix = this.parseMatrix(this.series);\n  }\n\n  performHealthCheck(dataValue, op, threshold) {\n    if (op == '=') {\n      return dataValue == threshold\n    } else if(op == '<') {\n      return dataValue < threshold\n    } else {\n      return dataValue >= threshold\n    }\n  }\n\n  parseMatrix(series) {\n      var that = this;\n      var matrix = {};\n      matrix['data'] = {}; // Raw data\n      matrix['cells'] = []; // Cells to render\n      matrix['summary_cell'] = { style: {},\n                                 value: '',\n                                 numUnhealthy: 0,\n                               } // Summary about matrix (i.e how many numbers are too small/big)\n\n      // Unique values for each row and column\n      var yCats = new Set();\n      var xCats = new Set();\n      // These are needed for referencing in loops below\n      let colorBackground = this.panel.colorBackground;\n      let colorValue = this.panel.colorValue;\n      let thresholds = this.panel.thresholds.split(',').map(function(strVale) {\n        return Number(strVale.trim());\n      });\n      let colors = this.panel.colors;\n      let separator = this.panel.separator;\n      let valueName = this.panel.valueName;\n\n      var numUnhealthyCells = 0;\n      let op = this.panel.healthCheckOperator;\n      let threshold = this.panel.healthCheckThreshold;\n\n      // Parse all the series into their buckets\n      angular.forEach(series, function(datapoint) {\n      var agg = datapoint.stats[valueName];\n      var datavalue = Number(agg).toFixed(1);\n      if (!that.performHealthCheck(datavalue, op, threshold)) {\n        numUnhealthyCells += 1;\n      }\n      let [yCat, xCat] = datapoint.label.split(separator);\n      yCats.add(yCat);\n      xCats.add(xCat);\n      if (!(yCat in matrix.data)) {\n        // Create the object if it doesn't exist\n        matrix.data[yCat] = {};\n      }\n      matrix.data[yCat][xCat] = datavalue;\n      });\n\n      if (numUnhealthyCells > 0) {\n        matrix['summary_cell']['style']['color'] = 'red';\n        matrix['summary_cell']['value'] = 'x';\n      }\n      else {\n        matrix['summary_cell']['style']['color'] = 'green';\n        matrix['summary_cell']['value'] = '✓';\n      }\n      matrix['summary_cell']['numUnhealthy'] = numUnhealthyCells;\n      \n      // Sort the axis categories\n      yCats = Array.from(yCats).sort();\n      xCats = Array.from(xCats).sort();\n\n      // Create the x axis label cells for the matrix\n      let rowNum = 1;\n      let colNum = 1;\n      for (let xCat of xCats) {\n        colNum++;  // Start 1 cell in, like the data\n        matrix['cells'].push({\n          value: xCat,\n          style: {\n            \"grid-row\": rowNum.toString(),\n            \"grid-column\": colNum.toString(),\n          }\n        });\n      }\n\n      // Create the rest of the rows\n      for (let yCat of yCats) {\n        rowNum++; // Start 1 cell in, like the data\n        colNum = 1; // This needs to be reset for each row\n        // Add a cell for the row header\n        matrix['cells'].push({\n          value: yCat,\n          style: {\n            \"grid-row\": rowNum.toString(),\n            \"grid-column\": colNum.toString(),\n            \"white-space\": \"nowrap\",  // Should move this into external CSS\n            \"text-align\": \"right\",  // Should move this into external CSS\n          }\n        });\n        // Create the data cells\n        for (let xCat of xCats) {\n          colNum++;\n          let value = matrix.data[yCat][xCat];\n          let cell = {\n            'yCat': yCat,\n            'xCat': xCat,\n            'value': value,\n            'tooltip': this.panel.tooltipHover,\n            'style': {\n              // These must be strings, otherwise they get silently ignored\n              'grid-row': rowNum.toString(),\n              'grid-column': colNum.toString(),\n            },\n          };\n          // Add coloring to the cell (if needed) and only if it has a value\n          if ((colorBackground || colorValue) && cell.value) {\n              let color = colors[0]; // Start with the base, and update if greater than thresholds\n              angular.forEach(thresholds, function(limit, i) {\n                if (cell.value >= limit) { color = colors[i+1]; }\n              });\n              if (colorBackground) { cell.style['background-color'] = color; }\n              if (colorValue) { cell.style['color'] = color; }\n          }\n          // Add the cell to the matrix\n          matrix.cells.push(cell)\n        }\n      }\n      return matrix;\n  }\n\n  parseSeries(series) {\n    return _.map(this.series, (serie, i) => {\n      return {\n        label: serie.alias,\n        data: serie.stats[this.panel.valueName],\n        color: this.panel.aliasColors[serie.alias] || this.$rootScope.colors[i]\n      };\n    });\n  }\n\n  onDataReceived(dataList) {\n    this.series = dataList.map(this.seriesHandler.bind(this));\n    this.data = this.parseSeries(this.series);\n    this.matrix = this.parseMatrix(this.series);\n    this.render(this.data);\n  }\n\n  seriesHandler(seriesData) {\n    var series = new TimeSeries({\n      datapoints: seriesData.datapoints,\n      alias: seriesData.target\n    });\n\n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n    return series;\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    rendering(scope, elem, attrs, ctrl);\n  }\n\n// Stolen from SingleStat\n// Try to subclass at some point to get this for free\n// I don't think we're actually using this specific option at the moment.\n  setColoring(options) {\n    if (options.background) {\n      this.panel.colorValue = false;\n      this.panel.colors = ['rgba(71, 212, 59, 0.4)', 'rgba(245, 150, 40, 0.73)', 'rgba(225, 40, 40, 0.59)'];\n    } else {\n      this.panel.colorBackground = false;\n      this.panel.colors = ['rgba(50, 172, 45, 0.97)', 'rgba(237, 129, 40, 0.89)', 'rgba(245, 54, 54, 0.9)'];\n    }\n    this.render();\n  }\n\n  invertColorOrder() {\n    // This seems to be designed for only 3\n    // var tmp = this.panel.colors[0];\n    // this.panel.colors[0] = this.panel.colors[2];\n    // this.panel.colors[2] = tmp;\n    // This is so much cleaner, easier, and scalable\n    this.panel.colors.reverse();\n    this.render();\n  }\n\n  onColorChange(panelColorIndex) {\n    return color => {\n      this.panel.colors[panelColorIndex] = color;\n      this.render();\n    };\n  }\n\n}\n\nGraLLAMACtrl.templateUrl = 'module.html';\n"]}